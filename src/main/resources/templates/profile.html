<!DOCTYPE html>

<html xmlns:th="http://www.thymeleaf.org" lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Edit profile</title>
  <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="/css/register.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
<aside class="sidebar">
    <a href="/home" class="nav-item"><h1>Menu</h1></a>

    <a href="/children" class="nav-item">My Kids</a>
    <a href="/wallet" class="nav-item">Wallet</a>

    <h1>Settings</h1>

    <a href="/home/profile" class="nav-item">Edit Profile</a>
    <a href="/home/users" class="nav-item" th:if="${parent.role.getDisplayName() == 'Admin'}">Users</a>
    <a href="/logout" class="nav-item">Logout</a>
</aside>
<section class="main-section">
    <div class="card profile-card">
        <h3>‚úèÔ∏è Update Your Profile</h3>

            <div style="flex: 1;">
                <h4 style="margin-bottom: 10px; color: #333;">
                    <span th:text="${parent.getFirstName() + ' ' + parent.getLastName()}">Your Name</span>
                </h4>
                <p style="margin: 5px 0;"><strong>Username:</strong> <span th:text="${parent.getUsername()}">-</span></p>
            </div>

        <div th:if="${successMessage}" class="alert-success" style="margin-bottom: 16px; padding: 12px 16px; border-radius: 6px; background: #d1e7dd; color: #0f5132; border: 1px solid #badbcc;">
            <span th:text="${successMessage}"></span>
        </div>
        <div th:if="${errorMessage}" style="margin-bottom: 16px; padding: 12px 16px; border-radius: 6px; background: #f8d7da; color: #842029; border: 1px solid #f5c2c7;">
            <span th:text="${errorMessage}"></span>
        </div>

        <form th:action="@{/home/profile}" method="post" th:object="${editRequest}"
              style="display: flex; flex-direction: column; gap: 15px;">

            <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
 
            <div>
                <label for="email" style="display: block; margin-bottom: 5px; font-weight: 500;">Email:</label>
                <input type="email" id="email" th:field="*{email}"
                       placeholder="Enter your email" required
                       style="width: 70%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <p th:if="${#fields.hasErrors('email')}" th:errors="*{email}" style="color: #842029; margin-top: 5px;"></p>
            </div>

            <div class="password-field">
                <label for="password">Password</label>
                <div class="password-input-wrapper">
                    <input type="password" id="password" th:field="*{password}" placeholder="Enter password" required minlength="4" maxlength="16" style="width: 70%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">

                    <!-- üëÅÔ∏è Toggle password visibility -->
                    <i id="toggleIcon" class="fa fa-eye" onclick="togglePassword('password','toggleIcon')"></i>
                </div>
            </div>

            <!-- üîí Password strength indicator -->
            <div class="password-strength">
                <div class="bar"></div>
                <div class="bar"></div>
                <div class="bar"></div>
            </div>
            <p th:if="${#fields.hasErrors('password')}" th:errors="*{password}" style="color: #842029; margin-top: 5px;"></p>

            <div>
                <label for="role" style="display: block; margin-bottom: 5px; font-weight: 500;">Role:</label>
                <select id="role" placeholder="Select role" th:field="*{role}" required
                        style="width: 70%; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
 
                    <option th:each="r : ${T(app.parent.model.ParentRole).values()}"
                            th:value="${r}"
                            th:text="${r.getDisplayName()}">Select Role
                    </option>
                </select>
                <p th:if="${#fields.hasErrors('role')}" th:errors="*{role}" style="color: #842029; margin-top: 5px;"></p>
 
            </div>
            <div style="display: flex; gap: 10px; margin-top: 10px;">
            <button type="submit"
                    class="action-btn add" >
                Update Profile
            </button>
            <a th:href="@{/home}"
               class="action-btn cancel" >
                Cancel
            </a>
            </div>
        </form>
    </div>
 
 </section>
<script>
    document.addEventListener("DOMContentLoaded", () => {
        const successAlert = document.querySelector(".alert-success");
        if (successAlert) {
            setTimeout(() => {
                successAlert.style.transition = "opacity 0.3s ease";
                successAlert.style.opacity = "0";

                setTimeout(() => {
                    successAlert.remove();
                    window.location.href = "/home";
                }, 500);
            }, 5000);
        }
    });
</script>
<script>
    function togglePassword(inputId, iconId) {
        const input = document.getElementById(inputId);
        const icon = document.getElementById(iconId);
        const isPassword = input.type === "password";
        input.type = isPassword ? "text" : "password";
        icon.classList.toggle("fa-eye");
        icon.classList.toggle("fa-eye-slash");
    }

    document.getElementById("password").addEventListener("input", function() {
        const value = this.value;
        const bars = document.querySelectorAll(".password-strength .bar");

        let strength = 0;
        if (value.length > 5) strength++;
        if (value.length > 8) strength++;
        if (/[A-Z]/.test(value) && /\d/.test(value)) strength++;

        bars.forEach((bar, index) => {
            if (index < strength) {
                bar.classList.add("filled");
            } else {
                bar.classList.remove("filled");
            }
        });
    });
</script>

</body>
</html>
